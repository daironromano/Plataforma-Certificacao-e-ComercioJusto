{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard Empresa - Amaz√¥nia Marketing{% endblock %}

{% block content %}

<style>
    :root {
        --verde-amazonia: #1C3E1D;
        --azul-rio: #225082;
        --amarelo-sol: #DABB2C;
        --texto: #333;
        --fundo: #f8f9fa;
        --borda: #e0e0e0;
    }

    .empresa-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    .header-empresa {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 40px;
        flex-wrap: wrap;
        gap: 20px;
    }

    .header-empresa h1 {
        color: var(--verde-amazonia);
        margin-bottom: 5px;
        font-size: 2.2rem;
        font-family: 'Calibri', sans-serif;
        font-weight: bold;
    }

    .header-empresa p {
        color: #666;
        margin: 0;
        font-size: 1rem;
    }

    .status-container {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .status-badge {
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.85rem;
        text-transform: uppercase;
        display: inline-block;
    }

    .status-verificado {
        background: #d4edda;
        color: #155724;
        border: 2px solid #28a745;
    }

    .status-pendente {
        background: #fff3cd;
        color: #856404;
        border: 2px solid #ffc107;
    }

    .btn-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .btn-empresa {
        padding: 10px 20px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-block;
        font-size: 0.95rem;
    }

    .btn-primary {
        background: var(--verde-amazonia);
        color: white;
    }

    .btn-primary:hover {
        background: #28a745;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .btn-secondary {
        background: var(--azul-rio);
        color: white;
    }

    .btn-secondary:hover {
        background: #1a3d61;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }

    .metric-card {
        background: white;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        border-left: 6px solid var(--verde-amazonia);
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .metric-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .metric-card.amarelo {
        border-left-color: var(--amarelo-sol);
    }

    .metric-card.azul {
        border-left-color: var(--azul-rio);
    }

    .metric-card h3 {
        margin: 0;
        color: #555;
        text-transform: uppercase;
        font-size: 0.9rem;
        font-weight: 600;
        letter-spacing: 0.5px;
    }

    .metric-number {
        font-size: 2.5rem;
        font-weight: bold;
        margin: 10px 0 5px 0;
        color: var(--texto);
    }

    .metric-subtitle {
        font-size: 0.85rem;
        color: #666;
    }

    .section-title {
        color: var(--verde-amazonia);
        border-bottom: 2px solid #eee;
        padding-bottom: 15px;
        margin-bottom: 25px;
        font-size: 1.8rem;
        font-family: 'Calibri', sans-serif;
        font-weight: bold;
    }

    .alert-warning {
        background: #fff3cd;
        border: 2px solid #ffc107;
        color: #856404;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 25px;
    }

    .alert-warning strong {
        display: block;
        margin-bottom: 10px;
        font-size: 1.1rem;
    }

    .alert-warning ul {
        margin: 10px 0;
        padding-left: 20px;
    }

    .alert-warning li {
        margin: 5px 0;
    }

    .docs-section {
        background: white;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }

    .doc-checklist {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
    }

    .doc-item {
        padding: 20px;
        border-radius: 8px;
        background: #f8f9fa;
        border-left: 4px solid #dc3545;
        transition: all 0.3s ease;
    }

    .doc-item.complete {
        background: #d4edda;
        border-left-color: #28a745;
    }

    .doc-item h4 {
        margin: 0 0 8px 0;
        color: var(--texto);
        font-weight: 600;
        font-size: 1rem;
    }

    .doc-item p {
        margin: 0;
        font-size: 0.9rem;
        color: #666;
    }

    .doc-status {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 600;
        margin-top: 8px;
    }

    .doc-status.pending {
        background: #fff3cd;
        color: #856404;
    }

    .doc-status.complete {
        background: #d4edda;
        color: #155724;
    }

    .juridico-section {
        background: linear-gradient(135deg, rgba(28, 62, 29, 0.1) 0%, rgba(34, 80, 130, 0.1) 100%);
        padding: 25px;
        border-radius: 8px;
        border: 2px solid var(--verde-amazonia);
        margin-bottom: 30px;
    }

    .juridico-section h3 {
        color: var(--verde-amazonia);
        margin-top: 0;
        font-weight: bold;
    }

    .juridico-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
    }

    .info-box {
        background: white;
        padding: 15px;
        border-radius: 6px;
        border-left: 3px solid var(--azul-rio);
    }

    .info-box label {
        display: block;
        font-weight: 600;
        color: #555;
        font-size: 0.9rem;
        text-transform: uppercase;
        margin-bottom: 5px;
    }

    .info-box p {
        margin: 0;
        color: var(--texto);
        font-size: 1.1rem;
        word-break: break-word;
    }

    .info-box.empty p {
        color: #999;
        font-style: italic;
    }

    .action-buttons {
        display: flex;
        gap: 15px;
        margin-top: 20px;
        flex-wrap: wrap;
    }

    .action-buttons a {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 12px 24px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
        min-width: 180px;
    }

    .action-buttons a.btn-edit {
        background: var(--verde-amazonia);
        color: white;
    }

    .action-buttons a.btn-edit:hover {
        background: #28a745;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .action-buttons a.btn-logout {
        background: #6c757d;
        color: white;
    }

    .action-buttons a.btn-logout:hover {
        background: #5a6268;
    }

    .verification-progress {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
    }

    .progress-bar {
        background: #e0e0e0;
        border-radius: 10px;
        height: 30px;
        overflow: hidden;
        margin: 15px 0;
    }

    .progress-fill {
        background: linear-gradient(90deg, var(--verde-amazonia), #28a745);
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 0.9rem;
        transition: width 0.3s ease;
    }

    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #999;
    }

    .empty-state p {
        font-size: 1.1rem;
        margin: 10px 0;
    }
</style>

<div class="empresa-container">
    <!-- Header -->
    <div class="header-empresa">
        <div>
            <h1>Dashboard da Empresa</h1>
            <p>Bem-vindo, {{ usuario_nome }}! Gerencie seus dados jur√≠dicos e certifica√ß√µes.</p>
        </div>
        <div class="status-container">
            {% if perfil.status_verificacao == 'verificado' %}
                <span class="status-badge status-verificado">Verificado</span>
            {% elif perfil.status_verificacao == 'rejeitado' %}
                <span class="status-badge" style="background: #f8d7da; color: #721c24; border: 2px solid #dc3545;">Rejeitado</span>
            {% else %}
                <span class="status-badge status-pendente">Pendente</span>
            {% endif %}
        </div>
    </div>

    <!-- Bot√µes de A√ß√£o -->
    <div class="btn-group" style="margin-bottom: 30px;">
        <a href="{% url 'config_perfil_empresa' %}" class="btn-empresa btn-primary">
            Editar Perfil
        </a>
        <a href="{% url 'home_publica' %}" class="btn-empresa btn-secondary">
            Ver Produtos
        </a>
        <a href="{% url 'logout' %}" class="btn-empresa" style="background: #6c757d; color: white;">
            Sair
        </a>
    </div>

    <!-- Alerta de Documenta√ß√£o Pendente -->
    {% if total_docs_pendentes > 0 %}
    <div class="alert-warning">
        <strong>ATEN√á√ÉO: Documenta√ß√£o Incompleta</strong>
        <p>Para evitar perfis falsos e garantir a credibilidade da sua empresa, complete os documentos obrigat√≥rios:</p>
        <ul>
            {% for doc in docs_pendentes %}
            <li><strong>{{ doc }}</strong> - N√£o enviado</li>
            {% endfor %}
        </ul>
        <a href="{% url 'config_perfil_empresa' %}" class="btn-empresa btn-primary" style="margin-top: 15px;">
            Enviar Documentos Agora
        </a>
    </div>
    {% endif %}

    <!-- M√©tricas Principais -->
    <h2 class="section-title">M√©tricas</h2>
    <div class="metrics-grid">
        <div class="metric-card">
            <h3>Produtos Cadastrados</h3>
            <p class="metric-number">{{ total_produtos }}</p>
            <p class="metric-subtitle">Seus produtos na plataforma</p>
        </div>

        <div class="metric-card amarelo">
            <h3>Certifica√ß√µes Pendentes</h3>
            <p class="metric-number">{{ certificacoes_pendentes }}</p>
            <p class="metric-subtitle">Aguardando aprova√ß√£o</p>
        </div>

        <div class="metric-card azul">
            <h3>Certifica√ß√µes Aprovadas</h3>
            <p class="metric-number">{{ certificacoes_aprovadas }}</p>
            <p class="metric-subtitle">Selos conquistados</p>
        </div>

        <div class="metric-card {% if perfil_completo %}azul{% else %}amarelo{% endif %}">
            <h3>Perfil Completo</h3>
            <p class="metric-number">{% if perfil_completo %}SIM{% else %}N√ÉO{% endif %}</p>
            <p class="metric-subtitle">Dados jur√≠dicos</p>
        </div>
    </div>

    <!-- Se√ß√£o de Dados Jur√≠dicos -->
    <div class="juridico-section">
        <h3>Dados Jur√≠dicos da Empresa</h3>
        <div class="juridico-info">
            <div class="info-box {% if perfil.cnpj %}{% else %}empty{% endif %}">
                <label>CNPJ</label>
                <p>{% if perfil.cnpj %}{{ perfil.cnpj }}{% else %}N√£o preenchido{% endif %}</p>
            </div>

            <div class="info-box {% if perfil.razao_social %}{% else %}empty{% endif %}">
                <label>Raz√£o Social</label>
                <p>{% if perfil.razao_social %}{{ perfil.razao_social }}{% else %}N√£o preenchido{% endif %}</p>
            </div>

            <div class="info-box {% if perfil.nome_fantasia %}{% else %}empty{% endif %}">
                <label>Nome Fantasia</label>
                <p>{% if perfil.nome_fantasia %}{{ perfil.nome_fantasia }}{% else %}N√£o preenchido{% endif %}</p>
            </div>

            <div class="info-box {% if perfil.status_verificacao == 'verificado' %}{% else %}empty{% endif %}">
                <label>Status de Verifica√ß√£o</label>
                <p>
                    {% if perfil.status_verificacao == 'verificado' %}
                        <span style="color: #1C3E1D; font-weight: 600;">‚úì Verificado pela Auditoria</span>
                    {% elif perfil.status_verificacao == 'rejeitado' %}
                        <span style="color: #dc3545; font-weight: 600;">‚úó Rejeitado</span>
                        {% if perfil.observacoes_verificacao %}
                            <br><small style="color: #666;">Motivo: {{ perfil.observacoes_verificacao }}</small>
                        {% endif %}
                    {% else %}
                        <span style="color: #dabb2c; font-weight: 600;">‚è≥ Pendente de verifica√ß√£o</span>
                    {% endif %}
                </p>
            </div>
        </div>
        <div class="action-buttons">
            <a href="{% url 'config_perfil_empresa' %}" class="btn-edit">Atualizar Dados Jur√≠dicos</a>
        </div>
    </div>

    <!-- Se√ß√£o de Documenta√ß√£o -->
    <h2 class="section-title">Documenta√ß√£o de Exist√™ncia</h2>
    <div class="docs-section">
        <p style="color: #666; margin-bottom: 20px;">
            <strong>Estes documentos comprovam a exist√™ncia legal da sua empresa.</strong> Eles s√£o revisados por auditores para garantir credibilidade na plataforma.
        </p>
        
        <div class="doc-checklist">
            <!-- Documento CNPJ -->
            <div class="doc-item {% if doc_cnpj_existe %}complete{% endif %}">
                <h4>ü™™ Cart√£o CNPJ</h4>
                <p>C√≥pia do Cart√£o CNPJ ou Certid√£o Simplificada da Receita Federal</p>
                {% if doc_cnpj_existe %}
                    <span class="doc-status complete">Enviado</span>
                    <p style="margin-top: 8px; font-size: 0.85rem;">
                        <a href="{{ perfil.documento_cnpj.url }}" target="_blank" style="color: #28a745; text-decoration: none;">
                            Visualizar documento
                        </a>
                    </p>
                {% else %}
                    <span class="doc-status pending">Pendente</span>
                {% endif %}
            </div>

            <!-- Contrato Social -->
            <div class="doc-item {% if contrato_social_existe %}complete{% endif %}">
                <h4>üìÑ Contrato Social / Estatuto</h4>
                <p>C√≥pia autenticada do Contrato Social ou Estatuto da empresa</p>
                {% if contrato_social_existe %}
                    <span class="doc-status complete">Enviado</span>
                    <p style="margin-top: 8px; font-size: 0.85rem;">
                        <a href="{{ perfil.documento_contrato_social.url }}" target="_blank" style="color: #28a745; text-decoration: none;">
                            Visualizar documento
                        </a>
                    </p>
                {% else %}
                    <span class="doc-status pending">Pendente</span>
                {% endif %}
            </div>

            <!-- Alvar√° de Funcionamento -->
            <div class="doc-item {% if alvara_existe %}complete{% endif %}">
                <h4>üìã Alvar√° de Funcionamento</h4>
                <p>Documento expedido pela prefeitura comprovando o direito de funcionamento da empresa</p>
                {% if alvara_existe %}
                    <span class="doc-status complete">Enviado</span>
                    <p style="margin-top: 8px; font-size: 0.85rem;">
                        <a href="{{ perfil.documento_alvara.url }}" target="_blank" style="color: #28a745; text-decoration: none;">
                            Visualizar documento
                        </a>
                    </p>
                {% else %}
                    <span class="doc-status pending">Pendente</span>
                {% endif %}
            </div>
        </div>

        <!-- Barra de Progresso -->
        {% if total_docs_pendentes > 0 %}
        <div class="verification-progress">
            <p style="margin-top: 0; color: #555; font-weight: 600;">
                Progresso de Documenta√ß√£o: {{ total_docs_pendentes }}/3 documentos
            </p>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ progresso|default:'0' }}%;">
                    {{ progresso|default:'0' }}%
                </div>
            </div>
            <p style="color: #666; font-size: 0.9rem; margin-bottom: 0;">
                Voc√™ completar√° o cadastro quando enviar todos os 3 documentos obrigat√≥rios.
            </p>
        </div>
        {% else %}
        <div class="verification-progress" style="background: #d4edda; border: 2px solid #28a745;">
            <p style="margin: 0; color: #155724; font-weight: 600;">
                Documenta√ß√£o Completa! Sua empresa est√° pronta para verifica√ß√£o pela administra√ß√£o.
            </p>
        </div>
        {% endif %}

        <div class="action-buttons">
            <a href="{% url 'config_perfil_empresa' %}" class="btn-edit">
                {% if total_docs_pendentes > 0 %}Enviar/Atualizar Documentos{% else %}Substituir Documentos{% endif %}
            </a>
        </div>
    </div>

    <!-- Informa√ß√µes de Contato -->
    {% if perfil.endereco or perfil.cidade or perfil.estado or perfil.telefone or perfil.email_contato %}
    <h2 class="section-title">Informa√ß√µes de Contato</h2>
    <div class="docs-section">
        <div class="juridico-info">
            {% if perfil.endereco %}
            <div class="info-box">
                <label>Endere√ßo Comercial</label>
                <p>{{ perfil.endereco }}, {{ perfil.numero|default:'' }}</p>
            </div>
            {% endif %}

            {% if perfil.cidade %}
            <div class="info-box">
                <label>Cidade / Estado</label>
                <p>{{ perfil.cidade }}, {{ perfil.estado|default:'' }}</p>
            </div>
            {% endif %}

            {% if perfil.cep %}
            <div class="info-box">
                <label>CEP</label>
                <p>{{ perfil.cep }}</p>
            </div>
            {% endif %}

            {% if perfil.telefone %}
            <div class="info-box">
                <label>Telefone</label>
                <p>{{ perfil.telefone }}</p>
            </div>
            {% endif %}

            {% if perfil.email_contato %}
            <div class="info-box">
                <label>Email de Contato</label>
                <p>{{ perfil.email_contato }}</p>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

</div>

{% endblock %}