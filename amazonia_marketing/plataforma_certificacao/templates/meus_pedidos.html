{% extends 'base.html' %}
{% load static %}

{% block title %}Meus Pedidos - Amazônia Marketing{% endblock %}

{% block content %}
<div class="container" style="max-width: 1200px; margin: 3rem auto; padding: 0 1rem;">
    
    <div style="background: linear-gradient(135deg, #27ae60 0%, #229954 100%); color: white; padding: 2rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <h1 style="margin: 0 0 0.5rem 0; font-size: 2rem;">Meus Pedidos</h1>
        <p style="margin: 0; opacity: 0.9;">Acompanhe o status dos seus pedidos</p>
    </div>

    {% if pedidos %}
        <div style="display: grid; gap: 1.5rem;">
            {% for pedido in pedidos %}
            <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid {% if pedido.status == 'pago' %}#27ae60{% elif pedido.status == 'enviado' %}#3498db{% elif pedido.status == 'entregue' %}#2ecc71{% elif pedido.status == 'cancelado' %}#e74c3c{% else %}#f39c12{% endif %};">
                
                <div style="display: grid; grid-template-columns: 1fr auto; gap: 2rem; margin-bottom: 1.5rem;">
                    <div>
                        <h2 style="margin: 0 0 1rem 0; color: #2c3e50;">Pedido #{{ pedido.pk }}</h2>
                        
                        <div style="display: grid; gap: 0.5rem;">
                            <div style="display: flex; gap: 2rem;">
                                <div>
                                    <span style="color: #7f8c8d; font-weight: 600;">Data:</span>
                                    <span style="color: #2c3e50;">{{ pedido.data_pedido|date:"d/m/Y H:i" }}</span>
                                </div>
                                
                                <div>
                                    <span style="color: #7f8c8d; font-weight: 600;">Pagamento:</span>
                                    <span style="color: #2c3e50;">{{ pedido.get_metodo_pagamento_display }}</span>
                                </div>
                            </div>
                            
                            {% if pedido.data_pagamento %}
                            <div>
                                <span style="color: #7f8c8d; font-weight: 600;">Pago em:</span>
                                <span style="color: #27ae60;">{{ pedido.data_pagamento|date:"d/m/Y H:i" }}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div style="text-align: right;">
                        <div style="padding: 8px 16px; background: {% if pedido.status == 'pago' %}#d4edda{% elif pedido.status == 'enviado' %}#d1ecf1{% elif pedido.status == 'entregue' %}#d4edda{% elif pedido.status == 'cancelado' %}#f8d7da{% else %}#fff3cd{% endif %}; color: {% if pedido.status == 'pago' %}#155724{% elif pedido.status == 'enviado' %}#0c5460{% elif pedido.status == 'entregue' %}#155724{% elif pedido.status == 'cancelado' %}#721c24{% else %}#856404{% endif %}; border-radius: 20px; display: inline-block; font-weight: 700; margin-bottom: 1rem;">
                            {{ pedido.get_status_display|upper }}
                        </div>
                        
                        <div style="font-size: 1.8rem; font-weight: 700; color: #27ae60;">
                            R$ {{ pedido.total|floatformat:2 }}
                        </div>
                    </div>
                </div>

                <!-- Itens do Pedido -->
                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
                    <h3 style="margin: 0 0 1rem 0; color: #2c3e50; font-size: 1.1rem;">Itens:</h3>
                    <div style="display: grid; gap: 0.75rem;">
                        {% for item in pedido.itempedido_set.all %}
                        <div style="display: grid; grid-template-columns: 60px 1fr auto; gap: 1rem; align-items: center;">
                            <div style="width: 60px; height: 60px; background: white; border-radius: 8px; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                                {% if item.produto.imagem %}
                                <img src="{{ item.produto.imagem.url }}" style="width: 100%; height: 100%; object-fit: cover;">
                                {% else %}
                                <span style="color: #ccc; font-size: 1.5rem;">Sem imagem</span>
                                {% endif %}
                            </div>
                            
                            <div>
                                <div style="font-weight: 600; color: #2c3e50;">{{ item.produto.nome }}</div>
                                <div style="color: #7f8c8d; font-size: 0.9rem;">Quantidade: {{ item.quantidade }} × R$ {{ item.preco_unitario|floatformat:2 }}</div>
                            </div>
                            
                            <div style="font-weight: 700; color: #27ae60;">
                                R$ {{ item.subtotal|floatformat:2 }}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Endereço de Entrega -->
                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
                    <h3 style="margin: 0 0 0.75rem 0; color: #2c3e50; font-size: 1.1rem;">Endereço de Entrega:</h3>
                    <div style="color: #555;">
                        {{ pedido.endereco_entrega }}<br>
                        {{ pedido.cidade_entrega }}, {{ pedido.estado_entrega }} - {{ pedido.cep_entrega }}<br>
                        Tel: {{ pedido.telefone_contato }}
                    </div>
                </div>

                <!-- Informações de Pagamento -->
                {% if pedido.id_transacao_pagamento %}
                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
                    <h3 style="margin: 0 0 0.75rem 0; color: #2c3e50; font-size: 1.1rem;">Informações de Pagamento:</h3>
                    <div style="color: #555;">
                        <div><strong>ID Transação:</strong> <span style="font-family: monospace;">{{ pedido.id_transacao_pagamento }}</span></div>
                        <div><strong>Método:</strong> {{ pedido.get_metodo_pagamento_display }}</div>
                    </div>
                </div>
                {% endif %}

                <!-- Rastreamento (se pedido enviado) -->
                {% if pedido.status == 'enviado' or pedido.status == 'entregue' %}
                <div style="background: #d1ecf1; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #3498db;">
                    <h3 style="margin: 0 0 0.75rem 0; color: #0c5460; font-size: 1.1rem;">Rastreamento:</h3>
                    <p style="margin: 0; color: #0c5460;">
                        {% if pedido.status == 'enviado' %}
                        Seu pedido está a caminho! Em breve você receberá o código de rastreamento.
                        {% else %}
                        Pedido entregue com sucesso!
                        {% endif %}
                    </p>
                </div>
                {% endif %}

                <!-- Ações -->
                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <a href="{% url 'detalhes_pedido' pedido.pk %}" style="padding: 0.75rem 1.5rem; background: #27ae60; color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">
                        Ver Detalhes
                    </a>
                    
                    {% if pedido.status == 'pendente' %}
                    <a href="{% url 'checkout' %}" style="padding: 0.75rem 1.5rem; background: #3498db; color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">
                        Continuar Pagamento
                    </a>
                    {% endif %}
                    
                    {% if pedido.status == 'entregue' %}
                    <button style="padding: 0.75rem 1.5rem; background: #95a5a6; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                        Avaliar Produtos
                    </button>
                    {% endif %}
                </div>

            </div>
            {% endfor %}
        </div>

        <!-- Paginação (se necessário) -->
        {% if pedidos.has_other_pages %}
        <div style="display: flex; justify-content: center; gap: 0.5rem; margin-top: 2rem;">
            {% if pedidos.has_previous %}
            <a href="?page=1" style="padding: 0.5rem 1rem; background: white; color: #27ae60; text-decoration: none; border-radius: 6px; border: 2px solid #27ae60;">« Primeira</a>
            <a href="?page={{ pedidos.previous_page_number }}" style="padding: 0.5rem 1rem; background: white; color: #27ae60; text-decoration: none; border-radius: 6px; border: 2px solid #27ae60;">Anterior</a>
            {% endif %}

            <span style="padding: 0.5rem 1rem; background: #27ae60; color: white; border-radius: 6px;">
                Página {{ pedidos.number }} de {{ pedidos.paginator.num_pages }}
            </span>

            {% if pedidos.has_next %}
            <a href="?page={{ pedidos.next_page_number }}" style="padding: 0.5rem 1rem; background: white; color: #27ae60; text-decoration: none; border-radius: 6px; border: 2px solid #27ae60;">Próxima</a>
            <a href="?page={{ pedidos.paginator.num_pages }}" style="padding: 0.5rem 1rem; background: white; color: #27ae60; text-decoration: none; border-radius: 6px; border: 2px solid #27ae60;">Última »</a>
            {% endif %}
        </div>
        {% endif %}

    {% else %}
        <div style="background: white; padding: 4rem 2rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h2 style="color: #7f8c8d; margin: 0 0 1rem 0;">Você ainda não fez nenhum pedido</h2>
            <p style="color: #95a5a6; margin: 0 0 2rem 0;">Comece a explorar nossos produtos certificados!</p>
            <a href="{% url 'home_publica' %}" style="display: inline-block; padding: 1rem 2rem; background: linear-gradient(135deg, #27ae60 0%, #229954 100%); color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">
                Explorar Produtos
            </a>
        </div>
    {% endif %}

</div>
{% endblock %}
